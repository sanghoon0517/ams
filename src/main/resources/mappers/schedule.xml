<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ams.schedule.model.dao.ScheduleDao">

    <resultMap id="ScheduleDto" type="com.ams.schedule.model.dto.ScheduleDto">
        <result property="title" column="title"/>
        <result property="s_idx" column="s_idx"/>
        <result property="c_idx" column="c_idx"/>
        <result property="t_idx" column="t_idx"/>
        <result property="color" column="color"/>
        <result property="startRecur" column="startRecur"/>
        <result property="endRecur" column="endRecur"/>
        <result property="startTime" column="startTime"/>
        <result property="endTime" column="endTime"/>
        <result property="groupId" column="groupId"/>
        <result property="allDay" column="allDay"/>
        <result property="routine" column="routine"/>
        <result property="daysOfWeek" column="daysOfWeek" typeHandler="com.ams.schedule.model.dto.JsonDataTypeHandler"/>

    </resultMap>
    <insert id="insertRepeatSchedule" parameterType="com.ams.schedule.model.dto.ScheduleDto">
        INSERT 
        INTO a_schedule(
            title,
            c_idx,
            t_idx,
            color,
            startRecur,
            endRecur,
            startTime,
            endTime,
            groupId,
            daysOfWeek,
            allDay,
            start,
            end,
            routine
        ) 
        VALUES(
            #{title},
            #{c_idx},
            #{t_idx},
            #{color},
            #{startRecur},
            #{endRecur},
            #{startTime},
            #{endTime},
            #{groupId},
            #{daysOfWeek,typeHandler=com.ams.schedule.model.dto.JsonDataTypeHandler},
            #{allDay},
            #{start},
            #{end},
            #{routine}
        )
    </insert>
    <select id="getSchedule" resultMap="ScheduleDto" parameterType="com.ams.schedule.model.dto.ScheduleParamDto">
        select
            s_idx, 
            title,
            c_idx,
            t_idx,
            color,
            startRecur,
            endRecur,
            startTime,
            endTime,
            groupId,
            daysOfWeek,
            allDay,
            start,
            end
        from a_schedule
        where 
        <![CDATA[
            (startRecur <= #{end} and endRecur >= #{start}) 
            OR 
            (start<= #{end} and end >= #{start})
        ]]>
    </select>
    <select id="getOneSchedule" parameterType="Integer" resultMap="ScheduleDto">
        select
            s_idx, 
            title,
            c_idx,
            t_idx,
            color,
            startRecur,
            endRecur,
            startTime,
            endTime,
            groupId,
            daysOfWeek,
            allDay,
            start,
            end,
            routine
        from a_schedule
        where s_idx = #{s_idx}
    </select>

    <update id="updateSchedule" parameterType="com.ams.schedule.model.dto.ScheduleDto">
        update a_schedule
        set 
            title = #{title},
            c_idx = #{c_idx},
            t_idx = #{t_idx},
            color = #{color},
            startRecur = #{startRecur},
            endRecur = #{endRecur},
            startTime = #{startTime},
            endTime = #{endTime},
            daysOfWeek = #{daysOfWeek,typeHandler=com.ams.schedule.model.dto.JsonDataTypeHandler},
            allDay = #{allDay},
            start = #{start},
            end = #{end},
            routine = #{routine}
        where 
            s_idx = #{s_idx}
    </update>
    <!-- <insert id="insertNonRepeatSchedule" parameterType="com.ams.schedule.model.dto.ScheduleDto">

    </insert> -->
</mapper>